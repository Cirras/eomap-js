(()=>{"use strict";const t=1,e=2,i=function(){let t=new Array(8);for(let e=0;e<8;++e){let i=1<<e+1,s=new Array(i);for(let t=0;t<i;++t)s[t]=Math.trunc(255*t/(i-1));t[e]=s}return t}(),s=0,r=3;class h{constructor(t,e,i,s){this.b=t,this.g=e,this.r=i,this.quad=s}}function a(t){return(t|=0)?31-Math.clz32(t&-t):0}class o{constructor(t){0===t&&(this.shift=0,this.mask=0,this.length=0),this.shift=a(t),this.mask=t>>this.shift,this.length=a(~this.mask)}read(t){return t=t>>this.shift&this.mask,i[this.length-1][t]}}class n{constructor(t,e,i,s){this.r=new o(t),this.g=new o(e),this.b=new o(i),this.a=new o(s)}}class d{constructor(t){this.data=t,this.dataView=new DataView(t),this.bitFields=null,this.paletteColors=null,this.initialized=!1}readUint8(t){return this.dataView.getUint8(t)}readUint16(t){return this.dataView.getUint16(t,!0)}readUint32(t){return this.dataView.getUint32(t,!0)}readUInt32WithZeroPadding(t){if(t+4<this.dataView.byteLength)return this.dataView.getUint32(t,!0);let e=new Uint8Array([0,0,0,0]);for(let i=0;i<e.length&&!(t>=this.dataView.byteLength);++i)e[i]=this.readUint8(t++);return new DataView(e.buffer).getUint32(0,!0)}get headerSize(){return this.readUint32(0)}get width(){return this.readUint32(4)}get height(){return this.readUint32(8)}get colorPlanes(){return 1}get depth(){return this.readUint16(14)}get compression(){return this.readUint32(16)}get imageSize(){return this.readUint32(20)}get paletteColorCount(){if(this.depth<16){let t=this.readUint32(32);return 0===t&&(t=1<<this.depth),t}return 0}get paletteSize(){let t=this.paletteColorCount;return t>0?4*t:40===this.headerSize&&this.compression==r?12:0}get bpp(){return this.depth>>3}get stride(){return(this.width*this.depth+31&-32)>>3}get redMask(){return this.readUint32(40)}get greenMask(){return this.readUint32(44)}get blueMask(){return this.readUint32(48)}get alphaMask(){return this.headerSize>=56?this.readUint32(52):0}colorFromPalette(t){return this.initialize(),t>=this.paletteColors.length?this.colorFromPalette(0):this.paletteColors[t]}checkFormat(){if(this.width<0)throw new Error("Image width less than zero");if(this.width>1073741824||this.height<-1073741824||this.height>1073741824)throw new Error("Image dimensions out of bounds");if(8!==this.depth&&16!==this.depth&&24!==this.depth&&32!==this.depth)throw new Error("Unsupported bit depth");if(this.compression!==s&&this.compression!==r)throw new Error("Unsupported compression");if(this.bitFields){let t=255;if(this.bitFields.r.mask>t||this.bitFields.g.mask>t||this.bitFields.b.mask>t||this.bitFields.a.mask>t)throw new Error("Bit mask too long")}}decodeBitFields(){if(this.compression===r)this.bitFields=new n(this.redMask,this.greenMask,this.blueMask,this.alphaMask);else switch(this.depth){case 16:this.bitFields=new n(31744,992,31,0);break;case 24:case 32:this.bitFields=new n(16711680,65280,255,0)}}indexPalette(){if(this.compression===r)return;this.paletteColors=new Array(this.paletteColorCount);let t=this.headerSize;for(let e=0;e<this.paletteColors.length;++e)this.paletteColors[e]=new h(this.readUint8(t++),this.readUint8(t++),this.readUint8(t++),this.readUint8(t++))}initialize(){this.initialized||(this.decodeBitFields(),this.indexPalette(),this.checkFormat(),this.initialized=!0)}readLine(t,e){let i=this.height<0?e:this.height-1-e,s=this.headerSize+this.paletteSize+this.stride*i,r=this.width*e*4;for(let e=0;e<this.width;++e){let e=0,i=0,h=0,a=0;switch(this.depth){case 8:let t=this.readUint8(s),r=this.colorFromPalette(t);e=r.b,i=r.g,h=r.r;break;case 16:case 24:case 32:let a=this.readUInt32WithZeroPadding(s);h=this.bitFields.r.read(a),i=this.bitFields.g.read(a),e=this.bitFields.b.read(a);break;default:throw Error("Unhandled bit depth: ".concat(this.depth))}0===h&&0===i&&0===e||(a=255),t[r++]=h,t[r++]=i,t[r++]=e,t[r++]=a,s+=this.bpp}}read(){this.initialize();const t=Math.abs(this.height);let e=new Uint8ClampedArray(this.width*t*4);for(let i=0;i<t;++i)this.readLine(e,i);return e}}const l=2;class c{constructor(t,e){this.resourceType=t,this.subdirectoryOffset=e}}class u{constructor(t,e,i,s){this.offset=t,this.size=e,this.codePage=i,this.unused=s}}class f{constructor(t,e,i,s){this.start=t,this.size=e,this.width=i,this.height=s}}class p{constructor(t){this.file=t,this.dataView=new DataView(t),this.position=0,this.virtualAddress=0,this.rootAddress=0,this.bitmapDirectoryEntry=new c,this.resourceInfo=new Map,this.readHeader(),this.readBitmapTable()}seek(t){this.position=t}skip(t){this.position+=t}readShort(){let t=this.dataView.getUint16(this.position,!0);return this.position+=2,t}readInt(){let t=this.dataView.getUint32(this.position,!0);return this.position+=4,t}readString(t){let e=new TextDecoder("utf-8").decode(new Uint8Array(this.file.slice(this.position,this.position+t)));return this.position+=t,e}readDirectoryEntryCount(){return this.skip(12),this.readShort()+this.readShort()}readResourceDirectoryEntry(){let t=this.readInt(),e=this.readInt();return new c(t,e)}readResourceDataEntry(){let t=this.readInt(),e=this.readInt(),i=this.readInt(),s=this.readInt();return new u(t,e,i,s)}readHeader(){this.seek(60);let t=this.readShort();if(this.skip(t-60-2),"PE\0\0"!==this.readString(4))throw new Error("Invalid PE file signature");this.skip(2);let e=this.readShort();this.skip(128),this.virtualAddress=this.readInt(),this.skip(120);for(let t=0;t<e;++t){if(this.readInt()==this.virtualAddress){this.skip(4),this.rootAddress=this.readInt();break}this.skip(36)}if(0==this.rootAddress)throw new Error("Invalid root address");this.seek(this.rootAddress);let i=this.readDirectoryEntryCount();for(let t=0;t<i;++t){let t=this.readResourceDirectoryEntry();if(t.resourceType===l)return this.bitmapDirectoryEntry=t,void(this.bitmapDirectoryEntry.subdirectoryOffset-=2147483648)}throw new Error("Missing bitmap resource directory")}readBitmapTable(){this.seek(this.rootAddress+this.bitmapDirectoryEntry.subdirectoryOffset);let t=this.readDirectoryEntryCount(),e=new Array;for(let i=0;i<t;++i){let t=this.readResourceDirectoryEntry();t.subdirectoryOffset>2147483648&&(t.subdirectoryOffset-=2147483648,e.push(t))}for(let t of e){this.seek(this.rootAddress+t.subdirectoryOffset+20);let e=this.readInt();this.seek(this.rootAddress+e);let i=this.readResourceDataEntry(),s=i.offset-this.virtualAddress+this.rootAddress,r=i.size;this.seek(s+4);let h=this.readInt(),a=this.readInt();this.resourceInfo.set(t.resourceType,new f(s,r,h,a))}}getResourceIDs(){return this.resourceInfo.keys()}getResourceInfo(t){let e=this.resourceInfo.get(t);return e||(e=null),e}readResource(t){return this.file.slice(t.start,t.start+t.size)}}self.egfs=new Map,self.loadDIB=function(t){try{let i=egfs.get(t.fileID);if(i){let s=i.getResourceInfo(t.resourceID);if(s){let r=i.readResource(s),h=new d(r).read();postMessage({loadType:e,fileID:t.fileID,resourceID:t.resourceID,pixels:h.buffer},[h.buffer])}}}catch(i){postMessage({loadType:e,fileID:t.fileID,resourceID:t.resourceID,error:i})}},self.loadEGF=function(e){try{if(egfs.has(e.fileID))throw new Error("EGF ".concat(e.fileID," was already loaded."));let i=new p(e.buffer);egfs.set(e.fileID,i),postMessage({loadType:t,fileID:e.fileID,resourceInfo:i.resourceInfo})}catch(i){postMessage({loadType:t,fileID:e.fileID,error:i})}},onmessage=function(i){let s=i.data;switch(s.loadType){case e:loadDIB(s);break;case t:loadEGF(s);break;default:throw new Error("Unhandled LoadType: ".concat(s.loadType))}}})();
//# sourceMappingURL=bundle.min.worker.js.map